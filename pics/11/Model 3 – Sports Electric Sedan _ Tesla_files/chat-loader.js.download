(function(){"use strict";const d=t=>{const o=document.cookie.split("; ");for(const n of o){const[e,s]=n.split("=");if(e===t)return JSON.parse(s)}return null},u=()=>{var t;return(t=window==null?void 0:window["cua-chat"])==null?void 0:t.chatHost},y="en_US",E="zh_CN",g="US",_="CN",v="NL",f="tesla.cn",w=(()=>{if(window.location.hostname.includes(f))return E;const o=window.location.pathname,n=/\/([a-zA-Z]{2})_([a-zA-Z]{2})/,e=o.match(n);return e?`${e[1]}_${e[2].toLocaleUpperCase()}`:y})(),A=(()=>{if(window.location.hostname.includes(f))return _;const o=window.location.pathname,n=/\/([a-zA-Z]{2})_([a-zA-Z]{2})/,e=o.match(n);return e?e[2].toLocaleUpperCase():g})(),S=async()=>{var s,i,a,r,c;const t=d("preferred_address");if((s=t==null?void 0:t.region)!=null&&s.regionCode)return t.region.regionCode;const o=d("device_location");if((i=o==null?void 0:o.region)!=null&&i.regionCode)return o.region.regionCode;const n=d("ip_info");if((a=n==null?void 0:n.region)!=null&&a.regionCode)return n==null?void 0:n.region.regionCode;const e=await $();return((c=(r=e==null?void 0:e.subdivisions)==null?void 0:r[0])==null?void 0:c.iso_code)||""},$=async()=>await fetch("https://location-services-prd.tesla.com/geoip/city").then(t=>t.json()),m=(()=>{var t,o;return(t=window==null?void 0:window["cua-chat"])!=null&&t.baseUrl?(o=window["cua-chat"])==null?void 0:o.baseUrl:""})(),p=t=>{if(t)return t instanceof Error?{message:t.message,name:t.name,stack:t.stack}:t},l=(t,o,n)=>{var e;try{const s=`${m}/cuaverse/api/logger/log`,i={app:"chat",eventName:"chat.loader",level:"error",location:(e=window==null?void 0:window.location)==null?void 0:e.href,message:t,timestamp:new Date().toISOString(),userAgent:navigator==null?void 0:navigator.userAgent,...o?{context:o}:{},...n?{error:p(n)}:{}},a=JSON.stringify(i,(r,c)=>c instanceof Error?p(c):typeof c=="bigint"?c.toString():c);fetch(s,{body:a,credentials:"include",headers:{"Content-Type":"application/json"},keepalive:!0,method:"POST"}).catch(()=>{})}catch{}},C=async()=>{if(u()!==void 0){h();return}const t=await S(),o=`${m}/conversation/get-chat-init-configs?locale=${w}&stateProvince=${t}&pageUrl=${encodeURIComponent(window.location.href)}`;fetch(o).then(n=>{if(!n.ok){const e=new Error(`[Chat Loader] Error getting chat configs - status ${n.status} ${n.statusText}`);throw l("Failed to fetch get-chat-init-configs",{status:n.status,statusText:n.statusText,url:o},e),e}return n.json()}).then(n=>{const e=n.LDChatConfigurations,s=e.isChatLite||e.triage||e.chatOnBasic;if(!e.isMobile&&window.screen.width<=599)return;if(new URLSearchParams(window.location.search).get("forceBRChat")==="true"&&([v,g].includes(A)||window.location.origin==="https://stage.tesla.com")){h(e);return}e.teslaAssistFlag||e.teslaAssistBREnabled||e.directToHumanAgent?h(e):s&&b()}).catch(n=>{l("get-chat-init-configs request failed",{locale:w,stateProvince:t,url:o},n)})},b=()=>{const t=document.createElement("script");t.src="/cua/assets/apps/oceana/chat-ui.js",t.async=!0;const o=document.createElement("link");o.href="/cua/assets/apps/oceana/chat-ui.css",o.rel="stylesheet",document.body.appendChild(t),document.body.appendChild(o);let n=0;const e=500,s=10,i=setInterval(()=>{var a;n++,(a=window==null?void 0:window.avaya)!=null&&a.init_chat?(window.avaya.init_chat(),clearInterval(i)):n>=s&&clearInterval(i)},e)},T=t=>{const o=u();return o||(t!=null&&t.directToHumanAgent?"chat_lite":t!=null&&t.teslaAssistBREnabled?t!=null&&t.orcaAvayaMigrationEnabled?"www_orca_avaya":"tas":t!=null&&t.teslaAssistFlag?"tas":t!=null&&t.isChatLite?"chat_lite":"www_orca_avaya")},h=t=>{var i;const n=`https://cua-chat-ui${[window.location.origin,(i=window==null?void 0:window["cua-chat"])==null?void 0:i.baseUrl].includes("https://stage.tesla.com")?"-stage":""}.tesla.com`,e=T(t),s=`${n}/.vite/manifest.${e}.json?v=${Date.now()}`;fetch(s).then(a=>{if(!a.ok){const r=new Error(`[Chat Loader] error fetching manifest.${e}.json - status ${a.status} ${a.statusText}`);throw l("Failed to fetch chat manifest",{manifestUrl:s,status:a.status,statusText:a.statusText,variant:e},r),r}return a.json()}).then(a=>{if(a.file){const r=document.createElement("script");if(r.src=`${n}/${a.file}`,r.async=!0,document.body.appendChild(r),a.css&&a.css.length>0){const c=document.createElement("link");c.href=`${n}/${a.css[0]}`,c.rel="stylesheet",document.body.appendChild(c)}}}).catch(a=>{l("manifest fetch failed",{manifestUrl:s,variant:e},a)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C):C()})();
